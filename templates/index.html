<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Transcription App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">
      <h1 class="my-4">Transkrip Otomatis, Cepat dan Akurat</h1>
      <div class="card bg-light mb-3">
        <div class="card-header bg-secondary text-white">
          <i class="bi bi-cloud-upload"></i> Unggah dokumen Anda
        </div>
        <div class="card-body">
          <form action="/transcribe" method="post" enctype="multipart/form-data">
            <div class="form-group">
              <label for="file"><i class="bi bi-file-earmark-music"></i> Pilih dokumen (max 25 MB):</label>
              <input type="file" name="file" id="file" accept=".mp3,.wav,.flac" max-size="25000000" required>
              <small class="form-text text-muted">Format yang didukung: mp3, wav, flac.</small>
            </div>
            <button type="submit" class="btn btn-primary"><i class="bi bi-play"></i> Transkrip</button>
          </form>
        </div>
      </div>

      <div class="progress mt-2" style="display: none;">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      
      <div class="card bg-light mt-4" id="hasil-transkripsi" style="display:none;">
        <div class="card-header bg-secondary text-white">
          <i class="bi bi-music-note-list"></i> Hasil Transkripsi
        </div>
        <div class="card-body">
          <textarea class="form-control" rows="5" id="result" name="result" readonly></textarea>
        </div>  
        <div class="card-body">  
          <p id="transcriptionTime" style="font-size: 14px;"></p>
        </div>
      </div>
      
    </div>  
      <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
      <script>
        $(document).ready(function() {
          $('form').submit(function(event) {
            event.preventDefault();
            var form_data = new FormData(this);
            var result = $('#result');
            var progress_bar = $('.progress-bar');
            var progress = $('.progress');

            var startTime = new Date().getTime();
    
            console.log(result)
            result.val('');
            progress.show();
            progress_bar.css('width', '0%');
    
            $.ajax({
              xhr: function() {
                var xhr = new window.XMLHttpRequest();
                xhr.upload.addEventListener('progress', function(evt) {
                  if (evt.lengthComputable) {
                    var percentComplete = evt.loaded / evt.total;
                    percentComplete = parseInt(percentComplete * 100);
                    progress_bar.css('width', percentComplete + '%');
                  }
                }, false);
                return xhr;
              },
              url: '/transcribe',
              type: 'POST',
              data: form_data,
              contentType: false,
              cache: false,
              processData: false,
              success: function(response) {
                var endTime = new Date().getTime(); // Get the current time again
                var transcriptionTime = (endTime - startTime) / 1000; // Calculate the time difference
                transcriptionTime = transcriptionTime.toFixed(2); // Round to 2 decimal places
                console.log(response);
                console.log(result);
                result.val(response);
                $('#transcriptionTime').text("Transcription time: " + transcriptionTime + " seconds");
                progress.hide();
                $('#hasil-transkripsi').show();
              },
              error: function(xhr, status, error) {
                result.val('Error: ' + xhr.responseText);
                progress.hide();
              }
            });
          });
        });
      </script>
  </body>